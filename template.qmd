---
format: 
  hkhd-revealjs:
     footer: "Heidelberg University Hospital   |   February 2024  |   Ignacio Leiva-Escobar"
incremental: false
embed-resources: true
editor:
  render-on-save: true

---


## {visibility="uncounted"}


:::{style="position: absolute; right: 840px; top: 0px; height: 245px; width: 245px; border:0px solid #D9D9D9 ;background-image: url('images/logo.png'); background-size: cover; background-repeat: no-repeat; padding: 0px; padding-left: 0px; box-shadow: 0px 0px 0px 0px #85929e; border-radius: 5px;"}
:::


:::{style="position: absolute; left: 295px; top: 0px; height: 245px; width: 245px; border:1px solid #D9D9D9 ;background-image: url('plot/plot_B.png'); background-size: cover; background-repeat: no-repeat; padding: 0px; padding-left: 0px; box-shadow: 0px 0px 0px 0px #85929e; border-radius: 5px;"}
:::


:::{style="position: absolute; right: 235px; top: 0px; height: 245px; width: 245px; border:1px solid #D9D9D9 ;background-image: url('plot/plot_C.png'); background-size: cover; background-repeat: no-repeat; padding: 0px; padding-left: 0px; box-shadow: 0px 0px 0px 0px #85929e; border-radius: 5px;"}
:::


:::{style="position: absolute; left: 840px; top: 0px; height: 245px; width: 245px; border:1px solid #D9D9D9 ;background-image: url('plot/plot_A.png'); background-size: cover; background-repeat: no-repeat; padding: 0px; padding-left: 0px; box-shadow: 0px 0px 0px 0px #85929e; border-radius: 5px;"}
:::


::: {style="position: absolute; right: 280px; top: 350px; height: 370px; width: 800px; border:0px solid #D9D9D9 ;background-color: #ffffff; padding: 0px; padding-left: 0px; box-shadow: 0px 0px 0px 0px #85929e; border-radius: 5px;"}

[Propensity Score in]{style="font-size: 1.6em; font-weight: bold;color: rgb(0, 74, 111)"}
[Pharmacoepidemiolgy]{style="font-size: 1.4em; font-weight: bold;color: #404080"}

[Ignacio Leiva-Escobar, MSc]{style="font-size: 35px; color: rgb(0, 74, 111)"}
:::

## Goals


<br>

>  **Briefly introduce the concept of casal effect**


<br>

> **Understand the role of propensity score in pharmacoepidemiology**

# {background-color="#004a6f"}




[Causal Effect Estimation]{style="position: absolute; left: 0px; top: 500px; font-size: 1.5em; font-weight: bold;color: white"}



## Level of evidence

![Source: https://openmd.com](images_presentation/levels-of-evidence.svg)

::: {.notes}
We've been taught that RCT are the study design that can prove causality and observational studies can help us to understand how for example treatments may work in clinical care (effectiveness). And we should use observational studies as hypothesis generated.

But what happens when is not feasible to conduct an RCT because of ethical issues or because the are time consuming. Additionally, we have access to routine data that we could use for answering some question. Then for example, during the pandemic many studies observational studies help clinicians to treat patients, some of them were some of them were baised though.


:::




## Causal Effect Estimation

<br>

`Causal effect` are of interest in many field

-  Prove ***causation*** over merely ***correlation***

Causal effect describes the `effect` of an exposure on an outcome

-  New treatment 
-  Prevention program
-  New policy

::: {.notes}
Here interesting in knowning how would a outcome of patient change. I are not interested in just knowing if there is a significant correlation/assicauton between the treatment and the outcome. We really wanna know if there is a causal effect.
:::



## How to get causal effect estimates

Machine time
figure
What would happen if got the treatment 

++ fundamental problem of causal inference

## How to get causal effect estimates 


![](images_presentation/46.svg){.absolute top=80 left=70}

. . .

![](images_presentation/47.svg){.absolute top=80 left=70}

. . .

![](images_presentation/48.svg){.absolute top=80 left=70}

. . .

![](images_presentation/49.svg){.absolute top=80 left=70}

. . .

![](images_presentation/50.svg){.absolute top=80 left=70}

. . .

![](images_presentation/51.svg){.absolute top=80 left=70}





## How to get causal effect estimates {auto-animate=true}

![](images_presentation/51.svg){.absolute top=80 left=60, width=800px}



:::{style="position: absolute; left: 800px; top: 190px; height: 170px; width: 280px; border:1.5px solid rgb(0, 74, 111) ;padding: 20px; padding-left: 20px; box-shadow: 0px 0px 5px 0px #6C3483; border-radius: 5px;"}

[Fundamental problem of causal inference]{style="position: absolute; font-size: 1em;color: rgb(0, 74, 111); text-align: center; vertical-align:"}

:::
## Potential outcome framework

- Two potential outcome for each study paticiapnt:

Outcome after receiving treatment = Y1
Outcome after receiving comparsion condition = Y0 (can be another treatmen or not treatment control)

- Y1 and Y0 exist for all individual in the population regardsles of whether the individual received treatment (Z=1) or comparison condition (Z = 0)
- Observe obly on of these outcomes for each participant
- Then the causal effect will be Y1-Y0 for a given individual

## Motivating example

- Proton pump inhibitors (PPI) use is linked to a higher risk of all-cause mortality, bone fractures, impaired absorption of micronutrients, dementia, liver disease, and increased risk of cirrhosis-related complications^[Brown JP, et al. Br J Clin Pharmacol 2021; 87: 3150â€“3161]

- PPI users experienced a 25% heightened risk of death from all causes compared to those taking H2 blockers^[Cholin L, et al. BMC Nephrol 2021, 22:264]

- PPI use has been associated with an increased risk of 
mortality in cancer patients, liver cirrhotics, and those requiring artificial nutrition^[Fossmark R, et al. Int J Mol Sci. 2019, 21;20(20):5203]

::: {.notes}
The idea is to know if treatment A is more effective than treatment B.
We have to acknowledge people who is receiving treatment A is different from people who is receiving treatment B. And we need to deal with that in order to estimate the causal effect of the treatment.

Then not bear in mind that the analysis of longitunal data benefit from these analysis

:::


## Motivating example

:::{style="position: absolute; left: 100px; top: 90px; height: 150px; width: 800px; border:1.5px solid rgb(0, 74, 111) ;padding: 5px; padding-left: 55px; box-shadow: 0px 0px 5px 0px #6C3483; border-radius: 5px;"}

Using a simulated data set, we will estimate the effect of PPI on all-cases mortality compared to (Histamine Type-2 Receptor Antagonists)H2RA

:::

. . .

![](images_presentation/52.svg){.absolute top=250 left=180 width=680px}


## Primary types of causal effect

- ATE

Answers the question:

   - how effective is the treatment in the population? If you have a control 
   - What is the relative effectiveness of two treatments  on average in the population? (If you hace 2 treatments)
   - E(Y1 - Y0)


- ATT

Answer the question

- How effective is a particular treatment for a particular population (the target group)
- How would those who received treatment have done had they received the comparison condition? ***
- E(Y1 - Y0 | Z =1)

  
# {background-color="#004a6f"}




[Propensity Score]{style="position: absolute; left: 0px; top: 500px; font-size: 1.5em; font-weight: bold;color: white"}




## Popularity of PS

![](images_presentation/popularity.png)

## What is the propensity score?


## Use of PS

## Type of PS

## Stratification

![](plot/stra_plot2.png)


::: {.notes}
take each strata to estimate treatment effect. Here groups are well balanced. People with similar PS to get the treatment. After getting the ATE at each strata, they are aggregated to get a final ATE
:::

## Matching

![](plot/match.png)

## Weighting {auto-animate=true}

![](plot/noWeights.png)

## Weighting {auto-animate=true}

![](plot/noWeights.png){.absolute top=180 left=0 width="500" height="350"}


![](plot/Weights.png){.absolute top=180 right=0 width="500" height="350"}




## Adventages and disadventages 

Paper......

## Weighting for the case

See the characteristic of the population 

## Covariate balance


![](plot/loveplot.png)



## Different PS approaches

Insert forstplot

```r
pagedown::chrome_print("path-to-file.html")
```


